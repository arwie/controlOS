{% extends "page.html" %}


{% block html %}
	<p>
	<div class="card">
		<div class="card-header" data-l10n-id="update-current"></div>
		<div class="card-body">
			<dl>
				<dt data-l10n-id="update-version-id"></dt>
				<dd data-bind="text: versionId"></dd>
			</dl>
		</div>
	</div>
	</p>
	
	<p>
	<label class="btn btn-primary btn-block">
		<span data-l10n-id="update-file"></span> 
		<input type="file" data-bind="event: {change: function() { upload($element.files[0]) }}" style="display: none;">
	</label>
	</p>
{% end %}


{% block model %}
class {
	constructor() {
		this.versionId = ko.observable();
		
		$.getJSON('/update', (data) => {
			this.versionId(data['version-id']);
		});
	}
	
	upload(file) {
		let formData = new FormData();
		formData.append('update', file);
		$.ajax({
			url: '/update',
			type: "put",
			data: formData,
			processData: false,
			contentType: false,
		})
		.done(function() {
			pager.navigate('');
		});
	}
}
{% end %}
