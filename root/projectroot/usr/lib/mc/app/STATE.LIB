
dim shared stateWatchdogIntervalMs as const long	= 1000



<?lib_init()?>
<?	libComOpenServerWebsocket('state_comStateServer', 33000, ['long("receive", false)'])?>
end sub



<?lib_prgLoop(14)?>
	select case com_receive(state_comStateServer, stateWatchdogIntervalMs)
	case com_receiveConnect, com_receiveMessage
		call com_clear
		call putState
	case else
		call com_clear
	end select
	call com_send(state_comStateServer)
end sub


sub putState
<?
	foreach ($libs['all'] as $l) 
		ll('call com_putLong("'.$l['name'].'", '.$l['name'].'_started)')
?>
end sub
